<!-- Simulado de Perguntas - Layout com Tabs -->
<div class="simulado-container-simplified">
  
  <!-- Header com EstatÃ­sticas -->
  <div class="header">
    <h2>ğŸ“ Perguntas</h2>
    <div class="stats" *ngIf="!isLoadingBibliografias">
      <span class="stat-item">
        <strong>{{ getStats().vf }}</strong> V/F
      </span>
      <span class="stat-item">
        <strong>{{ getStats().multipla }}</strong> MÃºltipla
      </span>
      <span class="stat-item">
        <strong>{{ getStats().correlacao }}</strong> CorrelaÃ§Ã£o
      </span>
      <span class="stat-item">
        <strong>{{ getStats().bibliografias }}</strong> {{ getStats().bibliografias === 1 ? 'bibliografia' : 'bibliografias' }}
      </span>
      <span class="stat-item">
        <strong>{{ getStats().assuntos }}</strong> {{ getStats().assuntos === 1 ? 'assunto' : 'assuntos' }}
      </span>
    </div>
  </div>
  
  <!-- Seletor de Bibliografia e Assunto - Sempre visÃ­vel -->
  <div class="filters-section" *ngIf="!isLoadingBibliografias">
    <div class="filter-row">
      <div class="filter-group">
        <label for="bibliografia-select">ğŸ“– Bibliografia:</label>
        <select 
          id="bibliografia-select"
          class="filter-select"
          [(ngModel)]="selectedBibliografiaId"
          (change)="onBibliografiaChange()"
          [disabled]="isLoadingBibliografias"
        >
          <option [ngValue]="null">Todas as Bibliografias</option>
          <option 
            *ngFor="let bibliografia of bibliografiasComEstatisticas" 
            [ngValue]="bibliografia.id"
          >
            {{ getBibliografiaOptionText(bibliografia) }}
          </option>
        </select>
      </div>
      
      <div class="filter-group">
        <label for="assunto-select">ğŸ·ï¸ Assunto:</label>
        <select 
          id="assunto-select"
          class="filter-select"
          [(ngModel)]="selectedAssunto"
          (change)="onAssuntoChange()"
          [disabled]="isLoadingBibliografias || assuntosDisponiveis.length === 0"
        >
          <option value="">Todos os Assuntos</option>
          <option 
            *ngFor="let assunto of assuntosDisponiveis" 
            [value]="assunto"
          >
            {{ assunto }}
          </option>
        </select>
      </div>
    </div>

    <!-- AÃ§Ãµes -->
    <div class="actions-row">
      <button 
        *ngIf="bibliografiaPath"
        class="btn btn-back"
        (click)="goToBibliografia()">
        <span class="back-arrow"></span>
        Voltar Ã  Bibliografia
      </button>
    </div>
  </div>
  
  <div *ngIf="isLoadingBibliografias" class="loading-text" style="text-align: center; padding: 1rem; color: #6b7280; font-style: italic;">
    Carregando bibliografias...
  </div>
  
  <!-- Sistema de Tabs -->
  <div class="tabs-container">
    <div class="tabs-header">
      <button 
        class="tab-button"
        [class.active]="activeTab === 'completo'"
        (click)="setActiveTab('completo')"
      >
        ğŸ“ Simulado Completo (15 questÃµes)
      </button>
      <button 
        class="tab-button"
        [class.active]="activeTab === 'vf'"
        (click)="setActiveTab('vf')"
      >
        âœ… Verdadeiro/Falso (20 questÃµes)
      </button>
      <button 
        class="tab-button"
        [class.active]="activeTab === 'multipla'"
        (click)="setActiveTab('multipla')"
      >
        ğŸ”˜ MÃºltipla Escolha (10 questÃµes)
      </button>
      <button 
        class="tab-button"
        [class.active]="activeTab === 'correlacao'"
        (click)="setActiveTab('correlacao')"
      >
        ğŸ”— CorrelaÃ§Ã£o (5 questÃµes)
      </button>
    </div>

    <!-- ConteÃºdo do Tab -->
    <div class="tabs-content">
      <!-- Loading das QuestÃµes -->
      <div *ngIf="isLoadingQuestions" class="loading-questions">
        <div class="loading-spinner"></div>
        <p>Carregando prova...</p>
      </div>

      <!-- Prova Carregada -->
      <div *ngIf="questionsLoaded && !isLoadingQuestions" class="prova-loaded">
    
    <!-- Header da Prova -->
    <div class="prova-header">
      <div class="prova-info">
        <h2>ğŸ“ Prova - {{ simuladoQuestions.length }} QuestÃµes</h2>
        <div class="prova-stats">
          <span class="stat">Respondidas: {{ getTotalAnsweredQuestions() }}/{{ simuladoQuestions.length }}</span>
          <span class="stat">Acertos: {{ getTotalCorrectAnswers() }}</span>
          <span class="stat" [class.good-score]="getScorePercentage() >= 70">
            Performance: {{ getScorePercentage().toFixed(1) }}%
          </span>
        </div>
      </div>
      
      <div class="prova-actions">
        <button 
          class="btn btn-pdf"
          (click)="downloadAsPDF()"
          [disabled]="simuladoQuestions.length === 0 || isGeneratingPDF">
          <mat-icon *ngIf="!isGeneratingPDF">picture_as_pdf</mat-icon>
          <mat-spinner *ngIf="isGeneratingPDF" diameter="16"></mat-spinner>
          {{ isGeneratingPDF ? 'Gerando PDF...' : 'Salvar PDF' }}
        </button>
        <button 
          class="btn btn-secondary gerar-nova-prova-btn"
          (click)="gerarNovaProva()"
          [disabled]="isLoadingQuestions"
        >
          ğŸ”„ Gerar Nova Prova
        </button>
      </div>
    </div>

    <!-- Lista de QuestÃµes -->
    <div class="questoes-list">
      <div 
        *ngFor="let question of simuladoQuestions; let i = index" 
        class="questao-item"
        [class.answered]="question.uniqueKey && isQuestionAnswered(question.uniqueKey)"
        [class.correct]="question.uniqueKey && getQuestionAnswerStatus(question.uniqueKey) === 'correct'"
        [class.incorrect]="question.uniqueKey && getQuestionAnswerStatus(question.uniqueKey) === 'incorrect'"
      >
        
        <!-- CabeÃ§alho da QuestÃ£o -->
        <div class="questao-header">
          <div class="questao-numero">
            <span class="numero">{{ i + 1 }}</span>
            <span class="tipo-badge" [class]="'tipo-' + question.tipo">
              {{ question.tipo === 'vf' ? 'V/F' : 
                 question.tipo === 'multipla' ? 'MÃºltipla' : 'CorrelaÃ§Ã£o' }}
            </span>
          </div>
          
          <div class="questao-info">
            <span *ngIf="question.bibliografia_titulo" class="bibliografia">
              ğŸ“š {{ question.bibliografia_titulo }}
            </span>
            <span *ngIf="question.paginas" class="paginas">
              ğŸ“„ {{ question.paginas }}
            </span>
          </div>

          <!-- Status da Resposta -->
          <div class="answer-status">
            <div *ngIf="question.uniqueKey && getQuestionAnswerStatus(question.uniqueKey) === 'correct'" class="status-badge correct">
              âœ… Correta
            </div>
            <div *ngIf="question.uniqueKey && getQuestionAnswerStatus(question.uniqueKey) === 'incorrect'" class="status-badge incorrect">
              âŒ Incorreta
            </div>
          </div>
        </div>

        <!-- ConteÃºdo da QuestÃ£o -->
        <div class="questao-content">
          <h4 class="questao-pergunta">{{ question.pergunta }}</h4>

          <!-- Pergunta Verdadeiro/Falso - Componente EspecÃ­fico -->
          <app-pergunta-v-f
            *ngIf="question.tipo === 'vf'"
            [questionId]="question.id"
            [questionData]="getVFData(question)"
            [isAnswered]="questionResults[question.uniqueKey!]?.answered || false"
            [isCorrect]="questionResults[question.uniqueKey!]?.isCorrect || false"
            (answerSubmitted)="onAnswerSubmitted($event)"
          ></app-pergunta-v-f>

          <!-- Pergunta MÃºltipla Escolha - Componente EspecÃ­fico -->
          <app-pergunta-multipla
            *ngIf="question.tipo === 'multipla'"
            [questionId]="question.id"
            [questionData]="getMultiplaData(question)"
            [isAnswered]="questionResults[question.uniqueKey!]?.answered || false"
            [isCorrect]="questionResults[question.uniqueKey!]?.isCorrect || false"
            (answerSubmitted)="onAnswerSubmitted($event)"
          ></app-pergunta-multipla>

          <!-- Pergunta de CorrelaÃ§Ã£o - Componente EspecÃ­fico -->
          <app-pergunta-correlacao
            *ngIf="question.tipo === 'correlacao'"
            [questionId]="question.id"
            [questionData]="getCorrelacaoData(question)"
            [isAnswered]="questionResults[question.uniqueKey!]?.answered || false"
            [isCorrect]="questionResults[question.uniqueKey!]?.isCorrect || false"
            (answerSubmitted)="onAnswerSubmitted($event)"
          ></app-pergunta-correlacao>

        </div>
      </div>

      <!-- Mensagem se nÃ£o hÃ¡ questÃµes ou questÃµes insuficientes -->
      <div *ngIf="!questionsLoaded && !isLoadingQuestions" class="no-questions">
        <h3 *ngIf="!insufficientQuestionsMessage">ğŸ¤” Nenhuma prova carregada</h3>
        <h3 *ngIf="insufficientQuestionsMessage">âš ï¸ NÃ£o foi possÃ­vel gerar a prova</h3>
        
        <div *ngIf="insufficientQuestionsMessage" class="insufficient-message">
          <p>{{ insufficientQuestionsMessage }}</p>
        </div>
        
        <p *ngIf="!insufficientQuestionsMessage">Configure as bibliografias e gere uma nova prova.</p>
        
        <button class="btn btn-primary" (click)="gerarNovaProva()">
          ğŸš€ Gerar Prova
        </button>
      </div>
    </div>
  </div>

</div>