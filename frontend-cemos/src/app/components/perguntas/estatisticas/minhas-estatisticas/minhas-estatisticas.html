<div class="minhas-estatisticas-container">
  <!-- Spinner de carregamento durante reset -->
  <div *ngIf="isResetting" class="loading-overlay">
    <div class="spinner-container">
      <div class="spinner"></div>
      <p class="spinner-message">Resetando estatísticas...</p>
    </div>
  </div>

  <!-- Componente de Detalhes da Matéria -->
  <app-info-materia-estatistica
    *ngIf="mostrarDetalhesMateria && materiaSelecionada"
    [materiaEstatistica]="materiaSelecionada"
    (voltar)="fecharDetalhesMateria()">
  </app-info-materia-estatistica>

  <!-- Cards de Matérias com Percentual de Acerto -->
  <div *ngIf="!mostrarDetalhesMateria" class="materias-cards-section">
    
    <div *ngIf="isLoadingMaterias" class="loading-materias">
      <div class="spinner-container-inline">
        <div class="spinner-inline"></div>
        <p>Carregando estatísticas por matéria...</p>
      </div>
    </div>
    
    <div *ngIf="!isLoadingMaterias && materiasEstatisticas.length > 0" class="materias-cards-grid">
      <div 
        *ngFor="let materiaStat of materiasEstatisticas; let i = index" 
        class="materia-card"
        [attr.data-materia-index]="getMateriaColorIndex(materiaStat.materia)"
        (click)="abrirDetalhesMateria(materiaStat, $event)"
        (mouseenter)="showTooltip($event)"
        (mouseleave)="hideTooltip()"
        (mousemove)="moveTooltip($event)">
        
        <div class="card-header">
          <div class="card-title-section">
            <mat-icon class="materia-icon">{{ getMateriaIcon(materiaStat.materia) }}</mat-icon>
            <div class="card-title-content">
              <h3>{{ materiaStat.materia }}</h3>
              <span class="bibliografias-count">({{ materiaStat.bibliografias.length }} bibliografias)</span>
            </div>
          </div>
          <div class="card-header-actions">
            <button 
              *ngIf="materiaStat.estatisticas.total > 0"
              class="btn-icon btn-reset"
              [disabled]="isResetting"
              (click)="onResetarEstatisticasMateria(materiaStat, $event)"
              (mouseenter)="hideTooltip()"
              title="Resetar estatísticas desta matéria">
              <mat-icon>refresh</mat-icon>
            </button>
          </div>
        </div>

        <div class="card-stats">
          <div class="stat-main">
            <!-- Mensagem quando não há respostas -->
            <div *ngIf="materiaStat.estatisticas.total === 0" class="percentual-acerto no-data">
              <div class="no-data-content">
                <mat-icon class="no-data-icon">info</mat-icon>
                <span class="no-data-text">Nenhuma questão respondida</span>
              </div>
              <div class="progress-bar-container">
                <div class="progress-bar" style="width: 0%; background: #e9ecef;"></div>
              </div>
            </div>
            
            <!-- Percentual com barra de progresso -->
            <div *ngIf="materiaStat.estatisticas.total > 0" class="percentual-acerto" 
                 [ngClass]="getPercentualClass(materiaStat.estatisticas.taxa_acerto, materiaStat.estatisticas.total)">
              <div class="percent-content">
                <span class="percent-value">{{ materiaStat.estatisticas.taxa_acerto }}%</span>
                <span class="percent-label">de acerto</span>
              </div>
              <div class="progress-bar-container">
                <div class="progress-bar" 
                     [style.background]="getProgressBarColor(materiaStat.estatisticas.taxa_acerto, materiaStat.estatisticas.total)"
                     [style.width.%]="materiaStat.estatisticas.taxa_acerto">
                </div>
              </div>
            </div>
          </div>
          
          <div class="stat-details">
            <div class="stat-badge">
              <span class="stat-label">Total:</span>
              <span class="stat-value">{{ materiaStat.estatisticas.total }}</span>
            </div>
            <div class="stat-badge success">
              <span class="stat-label">Acertos:</span>
              <span class="stat-value">{{ materiaStat.estatisticas.acertos }}</span>
            </div>
            <div class="stat-badge error">
              <span class="stat-label">Erros:</span>
              <span class="stat-value">{{ materiaStat.estatisticas.erros }}</span>
            </div>
          </div>
        </div>
      </div>
    </div>

  </div>

  <!-- Tooltip customizado que segue o mouse -->
  <div 
    class="custom-tooltip" 
    *ngIf="showTooltipFlag && !mostrarDetalhesMateria"
    [style.left.px]="tooltipX"
    [style.top.px]="tooltipY">
    Clique para ver os detalhes
  </div>
</div>
