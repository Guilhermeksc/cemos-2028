<!-- Pergunta de Correla√ß√£o -->
<div class="correlacao-question">
  <!-- Debug: Mostrar informa√ß√µes se dados n√£o estiverem dispon√≠veis -->
  <div *ngIf="!questionData || !questionData.coluna_a || !questionData.coluna_b || questionData.coluna_a.length === 0 || questionData.coluna_b.length === 0" class="error-message">
    <p>‚ö†Ô∏è Erro: Dados da quest√£o de correla√ß√£o n√£o dispon√≠veis.</p>
    <p>Question ID: {{ questionId }}</p>
    <p>Tem questionData: {{ !!questionData }}</p>
    <p>Tem coluna_a: {{ !!questionData.coluna_a }}</p>
    <p>Tem coluna_b: {{ !!questionData.coluna_b }}</p>
    <p>Coluna A length: {{ questionData.coluna_a.length }}</p>
    <p>Coluna B length: {{ questionData.coluna_b.length }}</p>
  </div>
  
  <!-- Conte√∫do principal: tudo em uma √∫nica div para garantir renderiza√ß√£o -->
  <div *ngIf="questionData && questionData.coluna_a && questionData.coluna_b && questionData.coluna_a.length > 0 && questionData.coluna_b.length > 0">
    <!-- Exibir a pergunta se existir -->
    <div class="pergunta" *ngIf="questionData.pergunta">
      <p><strong>Pergunta: </strong> <span [innerHTML]="getPerguntaFormatted()"></span></p>
    </div>
  
    
    <div class="correlacao-container">
      <div class="coluna coluna-a">
        <h5>Coluna A</h5>
        <div *ngFor="let item of questionData.coluna_a; let i = index" class="correlacao-item">
          <span class="item-number">{{ i + 1 }}.</span>
          <span class="item-text" [innerHTML]="getColunaAItemFormatted(item)"></span>
        </div>
      </div>
      
      <div class="coluna coluna-b">
        <h5>Coluna B</h5>
        <div *ngFor="let item of questionData.coluna_b; let i = index" class="correlacao-item">
          <span class="item-letter">{{ getStringFromCharCode(65 + i) }}.</span>
          <span class="item-text" [innerHTML]="getColunaBItemFormatted(item)"></span>
        </div>
      </div>
    </div>

    <div class="correlacao-mapping">
      <h6>Sua correla√ß√£o:</h6>
      
      <div *ngFor="let itemA of questionData.coluna_a; let i = index" 
           class="mapping-row-radio"
           [class.answered]="isItemAnswered(i + 1)">
        
        <div class="mapping-item-label">
          <span class="mapping-label-number">{{ i + 1 }}</span>
          <span class="mapping-item-text" [innerHTML]="getColunaAItemFormatted(itemA)"></span>
        </div>

        <div class="mapping-options">
          <label *ngFor="let itemB of questionData.coluna_b; let j = index" 
                 class="mapping-radio-option"
                 [class.selected]="userAnswer[(i + 1).toString()] === getStringFromCharCode(65 + j)">
            <input 
              type="radio"
              [name]="'correlacao-' + questionId + '-' + (i + 1)"
              [value]="getStringFromCharCode(65 + j)"
              [(ngModel)]="userAnswer[(i + 1).toString()]"
              (change)="updateCorrelacao(i + 1, getStringFromCharCode(65 + j))"
            />
            <span class="mapping-radio-label">{{ getStringFromCharCode(65 + j) }}</span>
          </label>
        </div>
      </div>
    </div>

    <div class="correlacao-help" *ngIf="!isComplete()">
      <span class="help-icon">‚ÑπÔ∏è</span>
      <span class="help-text">
        Complete todas as correla√ß√µes para responder. 
        <strong>Faltam {{ getMissingCount() }} item(ns)</strong>
      </span>
    </div>

    <button 
      class="btn btn-primary responder-btn correlacao-responder-btn"
      [disabled]="!isComplete()"
      (click)="onSubmit($event)"
      [title]="!isComplete() ? 'Complete todas as correla√ß√µes para responder' : ''"
    >
      {{ isAnswered ? 'üîÑ Atualizar Resposta' : 'üìù Responder' }}
    </button>

    <!-- Justificativa (aparece ap√≥s responder) -->
    <div *ngIf="isAnswered" class="justificativa">
      <div>
        <h5>‚úÖ Resposta Correta:</h5>
        <div class="correlacao-resposta">
          <div *ngFor="let itemA of questionData.coluna_a; let i = index" 
               class="correlacao-item-resposta">
            <strong>{{ i + 1 }}</strong> ‚Üí <strong>{{ getCorrectLetter((i + 1).toString()) }}</strong>
          </div>
        </div>
      </div>
      
      <div class="justificativa-texto">
        <h5>üí° Justificativa:</h5>
        <p [innerHTML]="getJustificativaFormatted()"></p>
      </div>
    </div>
  </div>
</div>
