<div class="capa-bibliografia-container">
  
  <!-- Loading Spinner -->
  <div class="loading-container" *ngIf="isLoading">
    <mat-spinner diameter="50"></mat-spinner>
    <p>Carregando conteúdo...</p>
  </div>

  <!-- Conteúdo -->
  <div class="content-wrapper" *ngIf="!isLoading && hasContent">

        <!-- Botões de navegação abaixo das imagens -->
    <div class="navigation-buttons" *ngIf="showNavigationButtons">
      <button mat-stroked-button color="primary" (click)="navigateHome()" aria-label="Voltar para Home">
        <span class="button-content">
          <mat-icon class="button-icon">arrow_back</mat-icon>
          <span class="button-text">Voltar</span>
        </span>
      </button>
      <button mat-stroked-button (click)="navigateTo(conceitosPath)" *ngIf="conceitosPath">
        <span class="button-content">
          <mat-icon class="button-icon">category</mat-icon>
          <span class="button-text">Conceitos</span>
        </span>
      </button>
      <button mat-stroked-button (click)="navigateTo(flashcardsPath)" *ngIf="flashcardsPath">
        <span class="button-content">
          <mat-icon class="button-icon">style</mat-icon>
          <span class="button-text">Flashcards</span>
        </span>
      </button>
      <button mat-stroked-button (click)="navigateTo(perguntasPath)" *ngIf="perguntasPath">
        <span class="button-content">
          <mat-icon class="button-icon">quiz</mat-icon>
          <span class="button-text">Perguntas</span>
        </span>
      </button>
      <button mat-stroked-button (click)="navigateTo(simuladosPath)" *ngIf="simuladosPath">
        <span class="button-content">
          <mat-icon class="button-icon">assignment</mat-icon>
          <span class="button-text">Simulados</span>
        </span>
      </button>
      <button mat-stroked-button (click)="navigateTo(checkAbandonoPath)" *ngIf="checkAbandonoPath">
        <span class="button-content">
          <mat-icon class="button-icon">checklist</mat-icon>
          <span class="button-text">Check Abandono</span>
        </span>
      </button>
      <button mat-stroked-button (click)="openSlidesViewer()" *ngIf="canShowSlidesButton()">
        <span class="button-content">
          <mat-icon class="button-icon">slideshow</mat-icon>
          <span class="button-text">Slides</span>
        </span>
      </button>
    </div>
    
    <!-- MODO MÚLTIPLAS CAPAS: Grid de capas clicáveis -->
    <div class="capas-grid" *ngIf="displayMode === 'multiple'">
      <div 
        *ngFor="let capa of capas" 
        class="capa-card"
        role="button"
        tabindex="0"
        (mouseenter)="showTooltip($event)"
        (mouseleave)="hideTooltip()"
        (mousemove)="moveTooltip($event)"
        (click)="navigateToCapa(capa)"
        (keydown.enter)="navigateToCapa(capa)"
        (keydown.space)="navigateToCapa(capa)"
        [attr.aria-label]="capa.title || 'Navegar para livro'"
        [attr.data-route]="capa.routePath">
      
        <div class="capa-image-wrapper">
          <!-- Indicador de Consulta no topo -->
          <div class="consulta-indicator" *ngIf="capa.permite_consulta !== undefined" [class.com-consulta]="capa.permite_consulta" [class.sem-consulta]="!capa.permite_consulta">
            <mat-icon>{{ capa.permite_consulta ? 'check_circle' : 'cancel' }}</mat-icon>
            <span>{{ capa.permite_consulta ? 'Com Consulta' : 'Sem Consulta' }}</span>
          </div>
          
          <!-- Indicador de Bloco abaixo do indicador de consulta -->
          <div class="bloco-indicator" *ngIf="capa.bloco" [style.background-color]="getBlocoColor(capa.blocoColor)">
            <span>{{ capa.bloco }}</span>
          </div>
          
          <img 
            [src]="getImageUrl(capa.imagePath)" 
            [alt]="capa.title || 'Capa da Bibliografia'"
            class="capa-image"
            [attr.draggable]="false"
            (error)="onImageError($event, capa.imagePath)">
        
          <!-- Overlay com título e descrição -->
          <div class="capa-overlay" *ngIf="capa.title || capa.description">
            <h3 class="capa-title" *ngIf="capa.title">{{ capa.title }}</h3>
            <p class="capa-description" *ngIf="capa.description">{{ capa.description }}</p>
          </div>
        </div>
      </div>
    </div>




    <!-- MODO SINGLE: Imagem única com markdown -->
    <div class="image-container" *ngIf="displayMode === 'single' && imagePath">
      <!-- Indicador de Consulta no topo (modo single) -->
      <div class="consulta-indicator" *ngIf="selectedCapa && selectedCapa.permite_consulta !== undefined" [class.com-consulta]="selectedCapa.permite_consulta" [class.sem-consulta]="!selectedCapa.permite_consulta">
        <mat-icon>{{ selectedCapa.permite_consulta ? 'check_circle' : 'cancel' }}</mat-icon>
        <span>{{ selectedCapa.permite_consulta ? 'Com Consulta' : 'Sem Consulta' }}</span>
      </div>
      
      <!-- Indicador de Bloco abaixo do indicador de consulta (modo single) -->
      <div class="bloco-indicator" *ngIf="selectedCapa?.bloco || bloco" [style.background-color]="getBlocoColor(selectedCapa?.blocoColor || blocoColor)">
        <span>{{ selectedCapa?.bloco || bloco }}</span>
      </div>
      
      <img 
        [src]="getImageUrl(imagePath)" 
        [alt]="'Capa da Bibliografia'"
        class="capa-image"
        (error)="onImageError($event, imagePath)">
    </div>

    <!-- Conteúdo Markdown (disponível em ambos os modos) -->
    <div class="markdown-content" *ngIf="htmlContent">
      <mat-card class="content-card">
        <mat-card-content>
          <div [innerHTML]="htmlContent"></div>
        </mat-card-content>
      </mat-card>
    </div>

  </div>

  <!-- Mensagem de Erro ou Sem Conteúdo -->
  <div class="no-content" *ngIf="!isLoading && !hasContent">
    <p>Nenhum conteúdo disponível</p>
    <p class="subtitle">Configure os caminhos de imagem e/ou markdown</p>
  </div>

  <!-- Tooltip customizado que segue o mouse -->
  <div 
    class="custom-tooltip" 
    *ngIf="showTooltipFlag"
    [style.left.px]="tooltipX"
    [style.top.px]="tooltipY">
    Clique para acessar o conteúdo.
  </div>

  <!-- PDF Slides Viewer Overlay -->
  <div class="slides-viewer-overlay" *ngIf="showSlidesViewer">
    <app-pdf-slides-viewer
      [pdfFolders]="pdfSlidesFolders"
      (closeRequested)="closeSlidesViewer()">
    </app-pdf-slides-viewer>
  </div>

</div>
