<div class="livro-container">
  
  <!-- Overlay para fechar menus no mobile -->
  <div 
    class="menu-overlay" 
    *ngIf="leftMenuOpen || rightMenuOpen"
    (click)="closeMenusOnOverlayClick($event)">
  </div>

  <!-- Menu Lateral Esquerdo - Arquivos -->
  <aside class="left-menu" [class.menu-open]="leftMenuOpen">
    
    <!-- Header do Menu Esquerdo -->
    <div class="menu-header" *ngIf="!isFullscreen">
      <!-- Botão de Fechar (Mobile) -->
      <button 
        class="menu-close-button mobile-only"
        (click)="toggleLeftMenu()"
        aria-label="Fechar menu">
        <mat-icon>close</mat-icon>
      </button>
      <!-- Botão de Voltar -->
      <button 
        *ngIf="backRoute"
        mat-icon-button 
        class="back-button"
        (click)="navigateBack()"
        [matTooltip]="'Voltar para ' + backLabel"
        matTooltipPosition="right"
        aria-label="Voltar">
        <mat-icon>arrow_back</mat-icon>
      </button>
      <!-- Botão de Tela Cheia (Desktop) -->
      <button 
        *ngIf="selectedFile"
        mat-icon-button 
        class="fullscreen-button desktop-only"
        (click)="openFullscreen()"
        [disabled]="!selectedFile"
        [matTooltip]="'Tela Cheia'"
        matTooltipPosition="right"
        aria-label="Tela Cheia">
        <mat-icon>fullscreen</mat-icon>
      </button>
      <!-- Botão de Download PDF (Desktop) -->
      <button 
        *ngIf="selectedFile"
        mat-icon-button 
        class="pdf-button desktop-only"
        (click)="downloadAsPDF()"
        [disabled]="!selectedFile || isGeneratingPDF"
        [matTooltip]="'Baixar como PDF'"
        matTooltipPosition="right"
        aria-label="Baixar como PDF">
        <mat-icon *ngIf="!isGeneratingPDF">picture_as_pdf</mat-icon>
        <mat-spinner *ngIf="isGeneratingPDF" diameter="20"></mat-spinner>
      </button>
      <!-- Botão de Slides (Desktop) -->
      <!-- <button 
        *ngIf="canShowSlidesButton()"
        mat-icon-button 
        class="slides-button desktop-only"
        (click)="openSlidesViewer()"
        [matTooltip]="'Visualizar Slides'"
        matTooltipPosition="right"
        aria-label="Visualizar Slides">
        <mat-icon>slideshow</mat-icon>
      </button> -->
    </div>

    <!-- Conteúdo do Menu Esquerdo -->
    <div class="menu-content">
      <div class="menu-title-container">
        <h3 class="menu-title">Arquivos</h3>
      </div>
      
      <mat-nav-list>
        <mat-list-item 
          *ngFor="let file of markdownFiles"
          [class.active]="selectedFile?.fileName === file.fileName"
          (click)="selectFile(file)">
          <mat-icon matListItemIcon>description</mat-icon>
          <div matListItemTitle class="file-title-wrapper">
            <span class="file-title">{{ file.title }}</span>
          </div>
        </mat-list-item>
      </mat-nav-list>
    </div>

  </aside>

  <!-- Área de Conteúdo Central -->
  <main class="content-area">
    
    <!-- Botões de Menu Mobile -->
    <div class="mobile-menu-buttons" *ngIf="!isLoading">
      <button 
        class="btn-mobile-menu"
        (click)="toggleLeftMenu()"
        aria-label="Abrir menu de arquivos">
        <mat-icon>menu</mat-icon>
        <span>Arquivos</span>
      </button>
      <button 
        class="btn-mobile-menu"
        (click)="toggleRightMenu()"
        aria-label="Abrir menu de índice">
        <mat-icon>list</mat-icon>
        <span>Índice</span>
      </button>
      <button 
        class="btn-mobile-menu btn-fullscreen-mobile"
        *ngIf="selectedFile"
        (click)="openFullscreen()"
        [disabled]="!selectedFile"
        aria-label="Tela cheia">
        <mat-icon>fullscreen</mat-icon>
        <span>Tela Cheia</span>
      </button>
      <button 
        class="btn-mobile-menu btn-slides-mobile"
        *ngIf="canShowSlidesButton()"
        (click)="openSlidesViewer()"
        aria-label="Slides">
        <mat-icon>slideshow</mat-icon>
        <span>Slides</span>
      </button>
    </div>
    
    <!-- Loading Spinner -->
    <div class="loading-container" *ngIf="isLoading">
      <mat-spinner diameter="50"></mat-spinner>
      <p>Carregando conteúdo...</p>
    </div>

    <!-- Conteúdo do Markdown -->
    <div class="markdown-content" *ngIf="!isLoading && selectedFile">
      <div class="content-wrapper" [innerHTML]="htmlContent"></div>
    </div>

    <!-- Mensagem quando não há arquivo selecionado -->
    <div class="no-content" *ngIf="!isLoading && !selectedFile">
      <mat-icon>description</mat-icon>
      <p>Nenhum arquivo selecionado</p>
      <p class="subtitle">Selecione um arquivo no menu lateral</p>
    </div>

  </main>

  <!-- Menu Lateral Direito - Índice -->
  <aside class="right-menu" [class.menu-open]="rightMenuOpen" *ngIf="false">
    
    <!-- Header do Menu Direito -->
    <div class="menu-header" *ngIf="!isFullscreen">
      <!-- Botão de Fechar (Mobile) -->
      <button 
        class="menu-close-button mobile-only"
        (click)="toggleRightMenu()"
        aria-label="Fechar menu">
        <mat-icon>close</mat-icon>
      </button>
      <!-- Espaço reservado para manter consistência visual -->
    </div>

    <!-- Conteúdo do Menu Direito -->
    <div class="menu-content">
      <div class="menu-title-container">
        <h3 class="menu-title">Índice</h3>
      </div>
      
      <div class="headings-tree" *ngIf="headings.length > 0">
        
        <ng-container *ngFor="let h1 of headings">
          <div class="heading-item level-1">
            
            <div class="heading-content" (click)="navigateToHeading(h1)">
              <mat-icon class="heading-icon">{{ getHeadingIcon(h1) }}</mat-icon>
              <span class="heading-title">{{ h1.title }}</span>
            </div>

            <div class="heading-children" *ngIf="isExpanded(h1) && h1.children && h1.children.length > 0">
              <ng-container *ngFor="let h2 of h1.children">
                <div class="heading-item level-2">
                  
                  <div class="heading-content" (click)="navigateToHeading(h2)">
                    <mat-icon class="heading-icon">{{ getHeadingIcon(h2) }}</mat-icon>
                    <span class="heading-title">{{ h2.title }}</span>
                  </div>

                </div>
              </ng-container>
            </div>

          </div>
        </ng-container>

      </div>
      
      <div class="no-headings" *ngIf="headings.length === 0">
        <p>Nenhum índice disponível</p>
      </div>
    </div>

  </aside>

  <!-- Fullscreen Overlay -->
  <div class="fullscreen-overlay" *ngIf="isFullscreen">
    <!-- Overlay para fechar menus no mobile (Fullscreen) -->
    <div 
      class="menu-overlay" 
      *ngIf="leftMenuOpen || rightMenuOpen"
      (click)="closeMenusOnOverlayClick($event)">
    </div>
    <div class="fullscreen-container">
      <!-- Menu Lateral Esquerdo - Arquivos (Fullscreen) -->
      <aside class="left-menu fullscreen-menu" [class.menu-open]="leftMenuOpen">
        <div class="menu-header" *ngIf="!isFullscreen">
          <!-- Botão de Fechar (Mobile) -->
          <button 
            class="menu-close-button mobile-only"
            (click)="toggleLeftMenu()"
            aria-label="Fechar menu">
            <mat-icon>close</mat-icon>
          </button>
          <button 
            *ngIf="backRoute"
            mat-icon-button 
            class="back-button"
            (click)="navigateBack()"
            [matTooltip]="'Voltar para ' + backLabel"
            matTooltipPosition="right"
            aria-label="Voltar">
            <mat-icon>arrow_back</mat-icon>
          </button>
          <!-- Botão de Tela Cheia (Desktop) -->
          <button 
            *ngIf="selectedFile"
            mat-icon-button 
            class="fullscreen-button desktop-only"
            (click)="openFullscreen()"
            [disabled]="!selectedFile"
            [matTooltip]="'Tela Cheia'"
            matTooltipPosition="right"
            aria-label="Tela Cheia">
            <mat-icon>fullscreen</mat-icon>
          </button>
          <!-- Botão de Download PDF (Desktop) -->
          <button 
            *ngIf="selectedFile"
            mat-icon-button 
            class="pdf-button desktop-only"
            (click)="downloadAsPDF()"
            [disabled]="!selectedFile || isGeneratingPDF"
            [matTooltip]="'Baixar como PDF'"
            matTooltipPosition="right"
            aria-label="Baixar como PDF">
            <mat-icon *ngIf="!isGeneratingPDF">picture_as_pdf</mat-icon>
            <mat-spinner *ngIf="isGeneratingPDF" diameter="20"></mat-spinner>
          </button>
          <!-- Botão de Slides (Desktop) -->
          <button 
            *ngIf="canShowSlidesButton()"
            mat-icon-button 
            class="slides-button desktop-only"
            (click)="openSlidesViewer()"
            [matTooltip]="'Visualizar Slides'"
            matTooltipPosition="right"
            aria-label="Visualizar Slides">
            <mat-icon>slideshow</mat-icon>
          </button>
        </div>
        <div class="menu-content">
          <div class="menu-title-container">
            <h3 class="menu-title">Arquivos</h3>
          </div>
          <mat-nav-list>
            <mat-list-item 
              *ngFor="let file of markdownFiles"
              [class.active]="selectedFile?.fileName === file.fileName"
              (click)="selectFile(file)">
              <mat-icon matListItemIcon>description</mat-icon>
              <div matListItemTitle class="file-title-wrapper">
                <span class="file-title">{{ file.title }}</span>
              </div>
            </mat-list-item>
          </mat-nav-list>
        </div>
      </aside>

      <!-- Área de Conteúdo Central (Fullscreen) -->
      <main class="fullscreen-content-area">
        <div class="fullscreen-header">
          <!-- Botões de Menu Mobile (Fullscreen) -->
          <div class="mobile-menu-buttons fullscreen-mobile-buttons" *ngIf="!isLoading">
            <button 
              class="btn-mobile-menu"
              (click)="toggleLeftMenu()"
              aria-label="Abrir menu de arquivos">
              <mat-icon>menu</mat-icon>
            </button>
            <button 
              class="btn-mobile-menu"
              (click)="toggleRightMenu()"
              aria-label="Abrir menu de índice">
              <mat-icon>list</mat-icon>
            </button>
          </div>
          <h3>{{ selectedFile?.title || 'Conteúdo' }}</h3>
          <button 
            class="btn-close-fullscreen"
            (click)="exitFullscreen()"
            aria-label="Fechar tela cheia">
            ✕
          </button>
        </div>
        
        <div class="fullscreen-content">
          <div class="content-wrapper" [innerHTML]="htmlContent"></div>
        </div>
        

      </main>

      <!-- Menu Lateral Direito - Índice (Fullscreen) -->
      <aside class="right-menu fullscreen-menu" [class.menu-open]="rightMenuOpen" *ngIf="false">
        <div class="menu-header" *ngIf="!isFullscreen">
          <!-- Botão de Fechar (Mobile) -->
          <button 
            class="menu-close-button mobile-only"
            (click)="toggleRightMenu()"
            aria-label="Fechar menu">
            <mat-icon>close</mat-icon>
          </button>
          <!-- Espaço reservado para manter consistência visual -->
        </div>
        <div class="menu-content">
          <div class="menu-title-container">
            <h3 class="menu-title">Índice</h3>
          </div>
          <div class="headings-tree" *ngIf="headings.length > 0">
            <ng-container *ngFor="let h1 of headings">
              <div class="heading-item level-1">
                <div class="heading-content" (click)="navigateToHeading(h1)">
                  <mat-icon class="heading-icon">{{ getHeadingIcon(h1) }}</mat-icon>
                  <span class="heading-title">{{ h1.title }}</span>
                </div>
                <div class="heading-children" *ngIf="isExpanded(h1) && h1.children && h1.children.length > 0">
                  <ng-container *ngFor="let h2 of h1.children">
                    <div class="heading-item level-2">
                      <div class="heading-content" (click)="navigateToHeading(h2)">
                        <mat-icon class="heading-icon">{{ getHeadingIcon(h2) }}</mat-icon>
                        <span class="heading-title">{{ h2.title }}</span>
                      </div>
                    </div>
                  </ng-container>
                </div>
              </div>
            </ng-container>
          </div>
          <div class="no-headings" *ngIf="headings.length === 0">
            <p>Nenhum índice disponível</p>
          </div>
        </div>
      </aside>
    </div>
  </div>

</div>
