<div class="conceitos-container">

  <!-- Header: breadcrumb + title (left) and navigation buttons (right) -->
  <header *ngIf="showHeader" class="header-generic-content" role="banner">
    <div class="header-left">
      <div class="breadcrumb">
        <a aria-label="M√≥dulo pai">{{ moduleEmoji ? (moduleEmoji + ' ') : '' }}{{ moduleLabel || 'M√≥dulo' }}</a>
      </div>
    </div>

    <!-- Bot√µes de navega√ß√£o (similar ao componente capa-bibliografia) -->
    <nav class="navigation-buttons" aria-label="Navega√ß√£o" *ngIf="!isLoading">
      <button class="btn btn-stroked" (click)="navigateTo(getPath('bibliografia'))" aria-label="Voltar para Bibliografia">
        ‚¨ÖÔ∏è Voltar √† Bibliografia
      </button>
      <button class="btn btn-stroked" (click)="navigateTo(getPath('flash-cards'))" aria-label="Flashcards">
        üìá Flashcards
      </button>
      <button class="btn btn-stroked" (click)="navigateTo(getPath('media'))" aria-label="Media">
        ‚ñ∂Ô∏è Media
      </button>
      <button class="btn btn-stroked" (click)="navigateTo(getPath('perguntas'))" aria-label="Perguntas">
        ‚ùì Perguntas
      </button>
      <button class="btn btn-stroked" (click)="navigateTo(getPath('conceitos'))" aria-label="Conceitos">
        üß≠ Conceitos
      </button>
    </nav>
  </header>

  <!-- Loading state -->
  <div class="loading-state" *ngIf="loading">
    <div class="spinner"></div>
    <p class="loading-text">Carregando conceitos...</p>
  </div>

  <!-- Error state -->
  <div class="error-state" *ngIf="error && !loading">
    <div class="error-icon">
      <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
        <circle cx="12" cy="12" r="10"></circle>
        <line x1="15" y1="9" x2="9" y2="15"></line>
        <line x1="9" y1="9" x2="15" y2="15"></line>
      </svg>
    </div>
    <p class="error-message">{{ error }}</p>
    <button 
      class="retry-button" 
      (click)="loadConceitos()">
      Tentar novamente
    </button>
  </div>

  <!-- Content with tabs -->
  <div *ngIf="!loading && !error" class="content-container">
    <!-- Bibliografia Tabs -->
    <div class="tabs-container" *ngIf="bibliografias.length > 1">
      <div class="tabs-border">
        <nav class="tabs-nav" aria-label="Tabs">
          <button
            *ngFor="let bibliografia of bibliografias; trackBy: trackByBibliografia"
            (click)="selectBibliografia(bibliografia.id)"
            [class.active]="selectedBibliografiaId === bibliografia.id"
            class="tab-button">
            {{ bibliografia.titulo }}
            <span class="tab-count">
              {{ getConceptCountByBibliografia(bibliografia.id) }}
            </span>
          </button>
        </nav>
      </div>
    </div>

    <!-- Selected Bibliografia Info -->
    <div *ngIf="selectedBibliografia && bibliografias.length > 1" class="bibliografia-info">
      <div class="bibliografia-content">
        <div class="bibliografia-icon">
          <svg class="icon" fill="none" stroke="currentColor" viewBox="0 0 24 24">
            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 6.253v13m0-13C10.832 5.477 9.246 5 7.5 5S4.168 5.477 3 6.253v13C4.168 18.477 5.754 18 7.5 18s3.332.477 4.5 1.253m0-13C13.168 5.477 14.754 5 16.5 5c1.746 0 3.332.477 4.5 1.253v13C19.832 18.477 18.246 18 16.5 18c-1.746 0-3.332.477-4.5 1.253"></path>
          </svg>
        </div>
        <div class="bibliografia-details">
          <h3 class="bibliografia-title">{{ selectedBibliografia.titulo }}</h3>
          <div class="bibliografia-meta">
            <span *ngIf="selectedBibliografia.autor">
              <strong>Autor:</strong> {{ selectedBibliografia.autor }}
            </span>
            <span *ngIf="selectedBibliografia.materia">
              <strong>Mat√©ria:</strong> {{ selectedBibliografia.materia }}
            </span>
          </div>
          <p *ngIf="selectedBibliografia.descricao" class="bibliografia-description">
            {{ selectedBibliografia.descricao }}
          </p>
        </div>
      </div>
    </div>

    <!-- Conceitos table -->
    <app-conceitos-table 
      [conceitos]="filteredConceitos"
      [title]="!showHeader ? (bibliografias.length <= 1 ? 'Conceitos' : 'Conceitos da Bibliografia') : ''"
      [showBibliografia]="bibliografias.length <= 1"
      [emptyMessage]="getEmptyMessage()">
    </app-conceitos-table>
  </div>
</div>
