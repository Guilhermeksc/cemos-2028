<!-- Simulado de Perguntas - Layout Simplificado -->
<div class="simulado-container-simplified">
  
  <!-- Loading das Quest√µes -->
  <div *ngIf="isLoadingQuestions" class="loading-questions">
    <div class="loading-spinner"></div>
    <p>Carregando prova...</p>
  </div>

  <!-- Prova Carregada -->
  <div *ngIf="questionsLoaded && !isLoadingQuestions" class="prova-loaded">
    
    <!-- Header da Prova -->
    <div class="prova-header">
      <div class="prova-info">
        <h2>üìù Prova - {{ simuladoQuestions.length }} Quest√µes</h2>
        <div class="prova-stats">
          <span class="stat">Respondidas: {{ getTotalAnsweredQuestions() }}/{{ simuladoQuestions.length }}</span>
          <span class="stat">Acertos: {{ getTotalCorrectAnswers() }}</span>
          <span class="stat" [class.good-score]="getScorePercentage() >= 70">
            Performance: {{ getScorePercentage().toFixed(1) }}%
          </span>
        </div>
      </div>
      
      <button 
        class="btn btn-secondary gerar-nova-prova-btn"
        (click)="gerarNovaProva()"
        [disabled]="isLoadingQuestions"
      >
        üîÑ Gerar Nova Prova
      </button>
    </div>

    <!-- Lista de Quest√µes -->
    <div class="questoes-list">
      <div 
        *ngFor="let question of simuladoQuestions; let i = index" 
        class="questao-item"
        [class.answered]="isQuestionAnswered(question.id)"
        [class.correct]="getQuestionAnswerStatus(question.id) === 'correct'"
        [class.incorrect]="getQuestionAnswerStatus(question.id) === 'incorrect'"
      >
        
        <!-- Cabe√ßalho da Quest√£o -->
        <div class="questao-header">
          <div class="questao-numero">
            <span class="numero">{{ i + 1 }}</span>
            <span class="tipo-badge" [class]="'tipo-' + question.tipo">
              {{ question.tipo === 'vf' ? 'V/F' : 
                 question.tipo === 'multipla' ? 'M√∫ltipla' : 'Correla√ß√£o' }}
            </span>
          </div>
          
          <div class="questao-info">
            <span *ngIf="question.bibliografia_titulo" class="bibliografia">
              üìö {{ question.bibliografia_titulo }}
            </span>
            <span *ngIf="question.paginas" class="paginas">
              üìÑ P√°ginas: {{ question.paginas }}
            </span>
          </div>

          <!-- Status da Resposta -->
          <div class="answer-status">
            <div *ngIf="!isQuestionAnswered(question.id)" class="status-badge not-answered">
              ‚è≥ N√£o respondida
            </div>
            <div *ngIf="getQuestionAnswerStatus(question.id) === 'correct'" class="status-badge correct">
              ‚úÖ Correta
            </div>
            <div *ngIf="getQuestionAnswerStatus(question.id) === 'incorrect'" class="status-badge incorrect">
              ‚ùå Incorreta
            </div>
          </div>
        </div>

        <!-- Conte√∫do da Quest√£o -->
        <div class="questao-content">
          <h4 class="questao-pergunta">{{ question.pergunta }}</h4>

          <!-- Pergunta Verdadeiro/Falso -->
          <div *ngIf="question.tipo === 'vf'" class="vf-question">
            <div class="afirmacao">
              <p><strong>Afirma√ß√£o:</strong> {{ getVFData(question).afirmacao }}</p>
            </div>
            
            <div class="vf-options">
              <label class="vf-option">
                <input 
                  type="radio"
                  [name]="'vf-' + question.id"
                  [value]="true"
                  [checked]="question.userAnswer === true"
                  (change)="question.userAnswer = true"
                />
                <span>Verdadeiro</span>
              </label>
              <label class="vf-option">
                <input 
                  type="radio"
                  [name]="'vf-' + question.id"
                  [value]="false"
                  [checked]="question.userAnswer === false"
                  (change)="question.userAnswer = false"
                />
                <span>Falso</span>
              </label>
            </div>

            <button 
              class="btn btn-primary responder-btn"
              [disabled]="question.userAnswer === undefined"
              (click)="answerQuestion(question.id, question.userAnswer)"
            >
              {{ isQuestionAnswered(question.id) ? 'üîÑ Atualizar Resposta' : 'üìù Responder' }}
            </button>
          </div>

          <!-- Pergunta M√∫ltipla Escolha -->
          <div *ngIf="question.tipo === 'multipla'" class="multipla-question">
            <div class="alternativas">
              <label class="alternativa">
                <input 
                  type="radio"
                  [name]="'multipla-' + question.id"
                  value="a"
                  [checked]="question.userAnswer === 'a'"
                  (change)="question.userAnswer = 'a'"
                />
                <span class="alternativa-letter">A)</span>
                <span class="alternativa-text">{{ getMultiplaData(question).alternativa_a }}</span>
              </label>
              <label class="alternativa">
                <input 
                  type="radio"
                  [name]="'multipla-' + question.id"
                  value="b"
                  [checked]="question.userAnswer === 'b'"
                  (change)="question.userAnswer = 'b'"
                />
                <span class="alternativa-letter">B)</span>
                <span class="alternativa-text">{{ getMultiplaData(question).alternativa_b }}</span>
              </label>
              <label class="alternativa">
                <input 
                  type="radio"
                  [name]="'multipla-' + question.id"
                  value="c"
                  [checked]="question.userAnswer === 'c'"
                  (change)="question.userAnswer = 'c'"
                />
                <span class="alternativa-letter">C)</span>
                <span class="alternativa-text">{{ getMultiplaData(question).alternativa_c }}</span>
              </label>
              <label class="alternativa">
                <input 
                  type="radio"
                  [name]="'multipla-' + question.id"
                  value="d"
                  [checked]="question.userAnswer === 'd'"
                  (change)="question.userAnswer = 'd'"
                />
                <span class="alternativa-letter">D)</span>
                <span class="alternativa-text">{{ getMultiplaData(question).alternativa_d }}</span>
              </label>
            </div>

            <button 
              class="btn btn-primary responder-btn"
              [disabled]="question.userAnswer === undefined"
              (click)="answerQuestion(question.id, question.userAnswer)"
            >
              {{ isQuestionAnswered(question.id) ? 'ÔøΩ Atualizar Resposta' : 'ÔøΩüìù Responder' }}
            </button>
          </div>

          <!-- Pergunta de Correla√ß√£o -->
          <div *ngIf="question.tipo === 'correlacao'" class="correlacao-question">
            <div class="correlacao-instructions">
              <p><strong>Correlacione os itens:</strong></p>
            </div>
            
            <div class="correlacao-container">
              <div class="coluna coluna-a">
                <h5>Coluna A</h5>
                <div *ngFor="let item of getCorrelacaoData(question).coluna_a; let i = index" class="correlacao-item">
                  <span class="item-number">{{ i + 1 }}.</span>
                  <span class="item-text">{{ item }}</span>
                </div>
              </div>
              
              <div class="coluna coluna-b">
                <h5>Coluna B</h5>
                <div *ngFor="let item of getCorrelacaoData(question).coluna_b; let i = index" class="correlacao-item">
                  <span class="item-letter">{{ getStringFromCharCode(65 + i) }})</span>
                  <span class="item-text">{{ item }}</span>
                </div>
              </div>
            </div>

            <div class="correlacao-mapping">
              <h6>Sua correla√ß√£o:</h6>
              <div *ngFor="let itemA of getCorrelacaoData(question).coluna_a; let i = index" 
                   class="mapping-row-radio"
                   [class.answered]="question.userAnswer?.[i + 1]">
                <div class="mapping-item-label">
                  <span class="mapping-label-number">{{ i + 1 }}</span>
                  <span class="mapping-item-text">{{ itemA }}</span>
                  <span class="mapping-status-badge" *ngIf="!question.userAnswer?.[i + 1]">
                    ‚è≥ Selecione uma op√ß√£o
                  </span>
                  <span class="mapping-status-badge answered" *ngIf="question.userAnswer?.[i + 1]">
                    ‚úÖ {{ question.userAnswer[i + 1] }}
                  </span>
                </div>
                <div class="mapping-options">
                  <label 
                    *ngFor="let itemB of getCorrelacaoData(question).coluna_b; let j = index" 
                    class="mapping-radio-option"
                    [class.selected]="question.userAnswer?.[i + 1] === getStringFromCharCode(65 + j)"
                  >
                    <input 
                      type="radio"
                      [name]="'correlacao-' + question.id + '-' + (i + 1)"
                      [value]="getStringFromCharCode(65 + j)"
                      [checked]="question.userAnswer?.[i + 1] === getStringFromCharCode(65 + j)"
                      (change)="updateCorrelacaoAnswer(question.id, i + 1, getStringFromCharCode(65 + j))"
                    />
                    <span class="mapping-radio-label">{{ getStringFromCharCode(65 + j) }}</span>
                  </label>
                </div>
              </div>
            </div>

            <div class="correlacao-help" *ngIf="!isCorrelacaoComplete(question)">
              <span class="help-icon">‚ÑπÔ∏è</span>
              <span class="help-text">
                Selecione uma op√ß√£o para cada item acima para habilitar o bot√£o de responder.
                Faltam <strong>{{ getCorrelacaoMissingCount(question) }}</strong> 
                {{ getCorrelacaoMissingCount(question) === 1 ? 'item' : 'itens' }}.
              </span>
            </div>

            <button 
              class="btn btn-primary responder-btn"
              [disabled]="!isCorrelacaoComplete(question)"
              (click)="submitCorrelacaoAnswer(question.id, question.userAnswer)"
              [title]="!isCorrelacaoComplete(question) ? 'Complete todas as correla√ß√µes para responder' : ''"
            >
              {{ isQuestionAnswered(question.id) ? 'üîÑ Atualizar Resposta' : 'üìù Responder' }}
            </button>
          </div>

          <!-- Justificativa (aparece ap√≥s responder) -->
          <div *ngIf="isQuestionAnswered(question.id)" class="justificativa">
            <div>
              <h5>‚úÖ Resposta Correta:</h5>
              
              <!-- Resposta V/F -->
              <p *ngIf="question.tipo === 'vf'">
                <strong>{{ getVFData(question).resposta_correta ? 'VERDADEIRO' : 'FALSO' }}</strong>
              </p>
              
              <!-- Resposta M√∫ltipla -->
              <p *ngIf="question.tipo === 'multipla'">
                <strong>Alternativa {{ getMultiplaData(question).resposta_correta.toUpperCase() }})</strong>
                {{ getAlternativaText(question, getMultiplaData(question).resposta_correta) }}
              </p>
              
              <!-- Resposta Correla√ß√£o -->
              <div *ngIf="question.tipo === 'correlacao'">
                <strong>Correla√ß√£o correta:</strong>
                <div class="correlacao-resposta">
                  <div *ngFor="let key of getCorrelacaoKeys(question)" class="correlacao-item-resposta">
                    <span>{{ key }} = {{ getCorrelacaoCorrectLetter(question, key) }}</span>
                  </div>
                </div>
              </div>
            </div>
            
            <div class="justificativa-texto">
              <h5>üí° Justificativa:</h5>
              <p>{{ getAnyData(question).justificativa_resposta_certa }}</p>
            </div>
          </div>
        </div>
      </div>
    </div>

    <!-- Resumo Final -->
    <div *ngIf="getTotalAnsweredQuestions() > 0" class="resumo-final">
      <h3>üìä Resumo da Prova</h3>
      <div class="resumo-stats">
        <div class="stat-card">
          <span class="stat-value">{{ getTotalAnsweredQuestions() }}</span>
          <span class="stat-label">Quest√µes Respondidas</span>
        </div>
        <div class="stat-card">
          <span class="stat-value">{{ getTotalCorrectAnswers() }}</span>
          <span class="stat-label">Acertos</span>
        </div>
        <div class="stat-card">
          <span class="stat-value">{{ getScorePercentage().toFixed(1) }}%</span>
          <span class="stat-label">Performance</span>
        </div>
      </div>
    </div>
  </div>

  <!-- Mensagem se n√£o h√° quest√µes -->
  <div *ngIf="!questionsLoaded && !isLoadingQuestions" class="no-questions">
    <h3>ü§î Nenhuma prova carregada</h3>
    <p>Configure as bibliografias e gere uma nova prova.</p>
    <button class="btn btn-primary" (click)="gerarNovaProva()">
      üöÄ Gerar Prova
    </button>
  </div>

</div>