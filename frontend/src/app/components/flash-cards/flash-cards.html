<div class="main-container" [class.fullscreen-mode]="isFullscreen">
    <!-- BotÃµes de navegaÃ§Ã£o (similar ao componente capa-bibliografia) -->
  <div class="header" [class.hidden-fullscreen]="isFullscreen">
    <h2>ğŸ“š Flash Cards</h2>
    <div class="stats" *ngIf="!isLoading">
      <span class="stat-item">
        <strong>{{ displayedFlashCards.length }}</strong> de <strong>{{ allFlashCards.length }}</strong> cards
      </span>
      <span class="stat-item">
        <strong>{{ bibliografias.length }}</strong> {{ bibliografias.length === 1 ? 'bibliografia' : 'bibliografias' }}
      </span>
      <span class="stat-item">
        <strong>{{ assuntosDisponiveis.length }}</strong> {{ assuntosDisponiveis.length === 1 ? 'assunto' : 'assuntos' }}
      </span>
    </div>
  </div>



  <!-- Filtros -->
  <div class="filters-section" *ngIf="!isLoading">
    <div class="filter-row">
      <!-- Filtro de Bibliografia -->
      <div class="filter-group">
        <label for="bibliografia-filter">ğŸ“– Bibliografia:</label>
        <select 
          id="bibliografia-filter"
          [(ngModel)]="selectedBibliografiaId"
          (ngModelChange)="onBibliografiaChange()"
          class="filter-select">
          <option [ngValue]="null">Todas as Bibliografias</option>
          <option 
            *ngFor="let bib of bibliografias" 
            [ngValue]="bib.id">
            {{ bib.titulo }}
            <span *ngIf="bib.flashcards_count">({{ bib.flashcards_count }} cards)</span>
          </option>
        </select>
      </div>

      <!-- Filtro de Assunto -->
      <div class="filter-group">
        <label for="assunto-filter">ğŸ·ï¸ Assunto:</label>
        <select 
          id="assunto-filter"
          [(ngModel)]="selectedAssunto"
          (ngModelChange)="onAssuntoChange()"
          class="filter-select"
          [disabled]="assuntosDisponiveis.length === 0">
          <option value="">Todos os Assuntos</option>
          <option 
            *ngFor="let assunto of assuntosDisponiveis" 
            [value]="assunto">
            {{ assunto }}
          </option>
        </select>
      </div>
    </div>

    <!-- AÃ§Ãµes -->
    <div class="actions-row">
      <button 
        class="btn btn-primary"
        (click)="loadRandomFlashCards()"
        [disabled]="allFlashCards.length === 0">
        ğŸ² Embaralhar
      </button>
      
      <button 
        class="btn btn-secondary"
        (click)="flipAllCards()"
        [disabled]="displayedFlashCards.length === 0">
        ğŸ”„ Virar Todos
      </button>
      
      <button 
        class="btn btn-outline"
        (click)="resetFilters()"
        [disabled]="!selectedBibliografiaId && !selectedAssunto">
        âœ–ï¸ Limpar Filtros
      </button>

      <button 
        class="btn btn-fullscreen"
        (click)="toggleFullscreen()"
        [class.btn-exit-fullscreen]="isFullscreen"
        *ngIf="!isLoading && displayedFlashCards.length > 0"
        [attr.aria-label]="isFullscreen ? 'Sair do modo tela cheia' : 'Entrar no modo tela cheia'">
        {{ isFullscreen ? 'â¤“ Sair da Tela Cheia' : 'â¤¢ Tela Cheia' }}
      </button>
    </div>
  </div>

  <!-- Loading -->
  <div class="loading-container" *ngIf="isLoading" [class.hidden-fullscreen]="isFullscreen">
    <div class="spinner"></div>
    <p>Carregando flash cards...</p>
  </div>

  <!-- Cards Grid -->
  <div class="flashcards-grid-wrapper" *ngIf="!isLoading && displayedFlashCards.length > 0">
    <ng-container *ngIf="isFullscreen; else defaultGridView">
      <div class="fullscreen-grid">
        <div class="fullscreen-row">
          <ng-container *ngFor="let card of topRowCards; trackBy: trackByCardId">
            <ng-container *ngTemplateOutlet="flashcardTemplate; context: {$implicit: card}"></ng-container>
          </ng-container>
        </div>
        <div class="fullscreen-row" *ngIf="bottomRowCards.length > 0">
          <ng-container *ngFor="let card of bottomRowCards; trackBy: trackByCardId">
            <ng-container *ngTemplateOutlet="flashcardTemplate; context: {$implicit: card}"></ng-container>
          </ng-container>
        </div>
      </div>
    </ng-container>
  </div>

  <ng-template #defaultGridView>
    <div class="flashcards-grid">
      <ng-container *ngFor="let card of displayedFlashCards; trackBy: trackByCardId">
        <ng-container *ngTemplateOutlet="flashcardTemplate; context: {$implicit: card}"></ng-container>
      </ng-container>
    </div>
  </ng-template>

  <ng-template #flashcardTemplate let-card>
    <div class="flashcard-wrapper">
      <div 
        class="flashcard"
        [class.flipped]="card.isFlipped"
        [class.prova-card]="card.prova"
        (click)="flipCard(card)">
        
        <!-- Frente do Card (Pergunta) -->
        <div class="flashcard-face flashcard-front">
          <div class="card-header">
            <span class="card-badge">â“ Pergunta</span>
            <div class="card-header-right">
              <span class="card-prova-badge" *ngIf="card.prova && card.ano" title="Caiu em prova">
                â­ {{ card.ano }}
              </span>
              <span class="card-assunto" *ngIf="card.assunto">
                ğŸ·ï¸ {{ card.assunto }}
              </span>
            </div>
          </div>
          
          <div class="card-content">
            <p class="card-question">{{ card.pergunta }}</p>
          </div>
          
          <div class="card-footer">
            <small class="card-bibliografia">
              ğŸ“š {{ card.bibliografia_titulo || getBibliografiaNome(card.bibliografia) }}
            </small>
            <small class="flip-hint">ğŸ‘† Clique para ver a resposta</small>
          </div>
        </div>

        <!-- Verso do Card (Resposta) -->
        <div class="flashcard-face flashcard-back">
          <div class="card-header">
            <span class="card-badge">âœ… Resposta</span>
            <div class="card-header-right">
              <span class="card-prova-badge" *ngIf="card.prova && card.ano" title="Caiu em prova">
                â­ {{ card.ano }}
              </span>
              <span class="card-assunto" *ngIf="card.assunto">
                ğŸ·ï¸ {{ card.assunto }}
              </span>
            </div>
          </div>
          
          <div class="card-content">
            <p class="card-answer">{{ card.resposta }}</p>
          </div>
          
          <div class="card-footer">
            <small class="card-bibliografia">
              ğŸ“š {{ card.bibliografia_titulo || getBibliografiaNome(card.bibliografia) }}
            </small>
            <small class="flip-hint">ğŸ‘† Clique para ver a pergunta</small>
          </div>
        </div>
      </div>
    </div>
  </ng-template>

  <!-- Mobile action bar (visÃ­vel no final em telas pequenas) -->
  <div class="mobile-action-bar" *ngIf="!isLoading && allFlashCards.length > 0 && !isFullscreen" role="toolbar" aria-label="AÃ§Ãµes rÃ¡pidas">
    <button 
      class="btn btn-primary"
      (click)="loadRandomFlashCards()"
      [disabled]="allFlashCards.length === 0"
      aria-label="Embaralhar">
      ğŸ² Embaralhar
    </button>
  </div>


  <!-- Empty State -->
  <div class="empty-state" *ngIf="!isLoading && displayedFlashCards.length === 0 && allFlashCards.length > 0">
    <div class="empty-icon">ğŸ”</div>
    <h3>Nenhum flash card encontrado</h3>
    <p>Tente ajustar os filtros ou embaralhar novamente.</p>
    <button class="btn btn-primary" (click)="resetFilters()">
      ğŸ”„ Resetar Filtros
    </button>
  </div>

  <!-- No Data State -->
  <div class="empty-state" *ngIf="!isLoading && allFlashCards.length === 0">
    <div class="empty-icon">ğŸ“­</div>
    <h3>Nenhum flash card disponÃ­vel</h3>
    <p>NÃ£o hÃ¡ flash cards cadastrados para as bibliografias selecionadas.</p>
  </div>
</div>
